# Lingo Leap 画面設計書

---

## 1. チャット画面

### 概要

ユーザーと AI が対話可能なメインのチャットインターフェース。ユーザーの学びたい内容の入力、AI による英語表現提案、音声再生、ブックマーク登録までを一貫して行います。

### 主な表示要素

- チャットメッセージエリア
  - ユーザーの発言と AI の返答（吹き出し形式、両者の区別明確に）
  - AI 返答は 3 つの別吹き出し
    - 各吹き出しに「音声アイコン」「ブックマークアイコン」
- 入力フォーム
  - テキスト入力欄（学びたい内容を入力）
  - 送信ボタン
- 画面上部（共通ヘッダー）
  - サービス名／ロゴ
  - ログイン状態（ユーザー名やアイコン表示）
  - ブックマーク一覧画面への導線

### 主なコンポーネント

- MessageBubble（AI／ユーザー共通・区別あり）
- InputForm
- Header（共通ヘッダー）
- AudioButton（音声再生用）
- BookmarkButton（ブックマーク登録）

### UI ポイント

- 吹き出しの色分け、発言者を見やすくする
- 音声アイコンクリック → ネイティブ発音再生。再生中はアイコン変化
- ブックマークアイコンクリック → 登録／解除トグル。状態反映（色変化など）
- メッセージごとに音声・ブックマーク機能が独立

### 実装詳細

#### ストリーミングチャット機能

- **技術スタック**: Vercel AI SDK (`@ai-sdk/react`, `@ai-sdk/openai`, `@ai-sdk/google`)
- **実装方式**: `useChat` フックを使用したストリーミング応答
- **API エンドポイント**: `/api/chat` (POST)
- **プロバイダー対応**: OpenAI と Google Gemini の両方に対応（環境変数で切り替え可能）
- **ストリーミング表示**: AI の応答はリアルタイムで文字が流れるように表示される

#### AI 応答の表示形式

- **3 つの吹き出し表示**: ユーザーの入力に対して、AI は必ず 3 つの異なる英語表現を提案
- **英語と日本語の分離表示**:
  - 各吹き出し内で、英語表現を大きく表示
  - その下に日本語訳を小さく表示（括弧内の形式で保存）
- **表示位置**: 画面の上部から順に表示（中央配置ではない）
- **グループ化**: 同一のユーザーメッセージに対する 3 つの応答は `messageSetId` でグループ化され、視覚的にまとめて表示

#### 音声再生機能

- **実装方式**: Web Speech API (`speechSynthesis`) を使用
- **再生速度の設定**: 設定画面で指定した速度に従って再生
  - **ゆっくり**: 0.7 倍速（学習者向けの聞き取りやすい速度）
  - **ふつう**: 1.0 倍速（ネイティブスピーカーの自然な速度、デフォルト）
  - **はやい**: 1.3 倍速（より速い再生速度）
- **UI**: 各吹き出しに 1 つの音声ボタンを表示
- **再生中の状態表示**: 再生中のボタンはハイライト表示され、停止アイコンに変化
- **再生対象**: 英語部分のみを再生（日本語部分は再生対象外）
- **声の種類**: 設定画面で指定した声のタイプ（デフォルト、女性 1、男性 1）を使用

#### ブックマーク機能

- **保存タイミング**: メッセージがデータベースに保存された後のみブックマーク可能
- **ストリーミング中の制限**: ストリーミング中のメッセージ（一時的な ID）はブックマークボタンを非表示
- **UUID 検証**: メッセージ ID が有効な UUID 形式であることを確認してからブックマーク処理を実行
- **エラーハンドリング**: メッセージが存在しない場合や、まだ保存されていない場合は適切なエラーメッセージを表示

#### ウェルカム画面

- **表示条件**: メッセージが 1 つもない場合に表示
- **レイアウト**: 画面の上部に配置（中央配置ではない）
- **主な要素**:
  - メインタイトル: 「英語学習を始めましょう！」
  - 使い方の説明: 入力方法、AI 応答の説明、音声再生機能の説明
  - 使用例: 4 つのカテゴリ（レストラン、会議、自己紹介、旅行）の例文をカード形式で表示
  - アクションの促し: 入力欄への誘導メッセージ
- **インタラクティブ要素**: 例文カードはホバー時に拡大表示される

#### 入力フォーム

- **制御方式**: `useState` と `useChat` フックを統合した制御コンポーネント
- **入力値の管理**: `inputValue` ステートで入力値を管理し、`useChat` の `input` と同期
- **送信処理**: `useChat` の `append` メソッドを使用してメッセージを送信
- **フォールバック**: `append` が利用できない場合は直接 API を呼び出し
- **無効化条件**: ローディング中または初期化中は入力フィールドと送信ボタンを無効化

#### メッセージの保存と表示

- **データベース保存**: ストリーミング完了後、`onFinish` コールバックでメッセージを解析してデータベースに保存
- **解析ロジック**: AI の応答を正規表現で解析し、3 つの英語表現と日本語訳を抽出
- **保存形式**: 英語と日本語を結合した形式で保存（表示時に分離）
- **表示の優先順位**: データベースから読み込んだメッセージを優先表示し、ストリーミング中のメッセージは補完的に表示

#### エラーハンドリング

- **API キー未設定**: 環境変数に AI API キーが設定されていない場合、詳細なエラーメッセージとヘルプ情報を表示
- **認証エラー**: 未認証ユーザーは適切なエラーメッセージと共に 401 ステータスを返す
- **メッセージ検証**: メッセージの形式や内容を検証し、不正な場合は適切なエラーメッセージを返す

---

## 2. ブックマーク一覧画面

### 概要

ユーザーが保存した英語メッセージ（単語／フレーズ／例文など）を一覧表示・管理する画面。

### 主な表示要素

- ブックマーク一覧（カードまたはリスト式）
  - 英語メッセージ本体
  - 音声再生アイコン
  - 削除ボタン（ブックマーク解除）
- 検索・フィルタ（任意・将来拡張）
- モーダルダイアログ（削除時の確認）
- 共通ヘッダー（チャット画面と同一コンポーネント）

### 主なコンポーネント

- BookmarkList
- BookmarkCard（または BookmarkRow）
- AudioButton
- DeleteBookmarkButton
- ModalDialog（削除確認用）
- Header

### UI ポイント

- 削除ボタン操作時は必ず確認モーダル表示
- 登録が多い場合にも見やすい一覧、並び替え・検索拡張も想定

---

## 3. ユーザー認証画面

### 概要

ユーザー新規登録／ログイン、パスワードリセット、OAuth 認証など基本的な認証操作画面。

### 主な表示要素

- ログイン・新規登録フォーム
  - メールアドレス／パスワード入力
  - ログインボタン、新規登録切替
- パスワードリセット（メール送信）
- OAuth ログインボタン（Google）
  - 「または」という区切り線でメール/パスワード認証と OAuth 認証を明確に分離
  - Google ログインボタン: Google ロゴと「Google でログイン」テキスト
  - ボタンは統一されたデザインで、ホバー時に視覚的フィードバックを提供

### OAuth 認証の詳細

#### 機能概要

- Google アカウントを使用したワンクリックログイン・新規登録
- OAuth 認証は既存のメール/パスワード認証と同等の機能を提供
- 初回利用時は自動的にアカウントが作成され、以降はログインとして機能

#### 表示要素

- 区切り線: 「または」テキストを含む水平線で、メール/パスワード認証と OAuth 認証を視覚的に分離
- OAuth ボタン: Google ログインボタン
  - Google ロゴと「Google でログイン」/「Google で登録」テキスト
  - ログイン画面では「Google でログイン」
  - 新規登録画面では「Google で登録」

#### 認証フロー

1. ユーザーが Google ログインボタンをクリック
2. Google の認証画面にリダイレクト
3. ユーザーが Google アカウントで認証
4. 認証成功後、`/auth/callback`にリダイレクト
5. コールバック処理でセッションを確立
6. ホームページ（`/`）にリダイレクト

#### セキュリティ要件

- Supabase の OAuth 認証機能を使用
- リダイレクト URL は環境変数から取得し、Supabase ダッシュボードで許可された URL と一致させる必要がある
- OAuth 認証エラー時は適切なエラーメッセージを表示

### 主なコンポーネント

- AuthForm
- OAuthLoginButton（Google）
- PasswordResetLink

### UI ポイント

- フォームはシンプル・安全・迷わない配置
- エラー時の通知・入力値のバリデーション明確に
- OAuth ボタンはメール/パスワードフォームと明確に区別され、視認性が高い
- 各 OAuth ボタンは統一されたデザインで、ブランドロゴを適切に表示
- ダークモードにも対応したデザイン

---

## 4. 共通・将来画面（案）

- 「学習履歴可視化」「マイページ」「管理者用」「FAQ/サポート」など、今後の拡張機能画面を追加予定

---

## 5. マイページ／ユーザープロファイル画面

### 概要

- ユーザーのアカウント情報やプロフィール、学習状況概要の表示・一部編集を行う画面。
- パスワード変更機能を含むアカウント管理機能を提供します。

### 主な表示要素

- 基本情報（メールアドレス、ユーザー名、登録日など）
- 学習状況（総ブックマーク数・直近の学習記録など）
- 情報編集用のフォーム
- アカウント削除・パスワード変更

### パスワード変更機能の詳細

#### 機能概要

- ログイン済みユーザーが現在のパスワードを確認して新しいパスワードに変更できる機能
- セキュリティのため、現在のパスワードの入力が必須

#### 表示要素

- アカウント情報表示エリア
  - メールアドレスの表示
- パスワード変更フォーム
  - 現在のパスワード入力欄（必須）
  - 新しいパスワード入力欄（必須、6 文字以上）
  - 新しいパスワード確認入力欄（必須）
  - 各パスワード入力欄には表示/非表示切り替えボタン
  - パスワード変更ボタン
- 結果メッセージ表示エリア
  - 成功時: 成功メッセージを表示
  - エラー時: エラーメッセージを表示

#### バリデーション

- 現在のパスワードが入力されているか
- 新しいパスワードが 6 文字以上か
- 新しいパスワードと確認用パスワードが一致しているか
- 新しいパスワードが現在のパスワードと異なるか
- 現在のパスワードが正しいか（サーバー側で検証）

#### セキュリティ要件

- 現在のパスワードでログインを試行し、正しいことを確認してから変更を実行
- 未認証ユーザーはアクセス不可（ログインページにリダイレクト）
- パスワード入力欄はデフォルトで非表示（表示/非表示切り替え可能）

#### 画面遷移

- URL: `/profile`
- 未認証時: `/auth/login` にリダイレクト
- 変更成功時: フォームをクリアし、成功メッセージを表示

### 主なコンポーネント

- ProfileCard
- EditProfileForm
- DeleteAccountButton
- ChangePasswordForm

### UI ポイント

- シンプルで整理された個人情報管理 UI
- 編集時は適切な認証・バリデーション
- パスワード変更フォームは明確に分離され、視認性が高い
- エラーメッセージは分かりやすく、ユーザーが修正しやすい形式

---

## 6. 学習履歴画面

### 概要

- 学習履歴や過去のやり取り、時間別の学習記録の可視化を行う画面。

### 主な表示要素

- チャット履歴一覧
- 日/月単位の学習記録グラフ

### 主なコンポーネント

- HistoryList
- ProgressChart

### UI ポイント

- 時系列表示、グラフは一目で進捗把握しやすく
- 過去のやりとりへ遷移も可能

---

## 7. FAQ・サポート画面

### 概要

- よくある質問と回答、ユーザーガイド、お問い合わせフォーム提供

### 主な表示要素

- FAQ リスト
- お問い合わせ（フォーム／メールアドレス）

### 主なコンポーネント

- FAQList
- ContactForm

### UI ポイント

- カテゴリ分け、検索機能も視野
- シンプルな入力 UI

---

## 8. 設定画面

### 概要

- ユーザー毎のカスタマイズ設定（学習レベル、音声、テーマ、プライバシー）を管理する画面
- URL: `/settings`
- 未認証時: `/auth/login` にリダイレクト
- マイページと同様のカード型レイアウトで統一

### 主な表示要素

- 4 つの設定セクション（カード形式で縦に並べる）
  1. **学習レベル**
     - セクションタイトル：「学習レベル」
     - 説明文：「英語の難易度を選択できます。今のレベルに近いものを選んでください。」
     - ラジオボタンで選択：
       - 「やさしい」（internal value: `beginner`）
       - 「ふつう」（internal value: `standard`、デフォルト）
       - 「チャレンジ」（internal value: `advanced`）
  2. **音声設定**
     - セクションタイトル：「音声設定」
     - 説明文：「チャットの読み上げの有無やスピード、声の種類を変更できます。」
     - 読み上げ ON/OFF（トグルスイッチ）
       - ラベル：「読み上げを有効にする」
       - デフォルト: ON（`true`）
     - 読み上げ速度（セレクトボックス）
       - ラベル：「読み上げ速度」
       - 選択肢：「ゆっくり」（`slow`）、「ふつう」（`normal`、デフォルト）、「はやい」（`fast`）
     - 声の種類（セレクトボックス）
       - ラベル：「声のタイプ」
       - 選択肢：「デフォルト」（`null`）、「女性 1」（`female_1`）、「男性 1」（`male_1`）
  3. **テーマ**
     - セクションタイトル：「テーマ」
     - 説明文：「画面の明るさや文字サイズを変更できます。」
     - カラーテーマ（ラジオボタン）
       - 「ライト」（`light`、デフォルト）、「ダーク」（`dark`）
     - フォントサイズ（セレクトボックス）
       - 選択肢：「小さめ」（`small`）、「ふつう」（`medium`、デフォルト）、「大きめ」（`large`）
  4. **学習履歴の記録設定**
     - セクションタイトル：「学習履歴を記録して、あなたの進捗をグラフで確認できます。」
     - 説明文：「学習活動を記録すると、「学習履歴可視化」ページで日別の推移や活動内訳をグラフで確認できます。」
     - チェックボックス
       - ラベル：「学習活動を記録する（チャット・音声再生・ブックマーク）」
       - 補足：「※記録されたデータは、学習履歴ページでグラフとして表示されます。」
       - デフォルト: OFF（`false`）
- 保存ボタン（全設定を一度に保存）
- 成功/エラーメッセージ表示エリア

### 主なコンポーネント

- SettingsPage（メインページコンポーネント）
- ThemeProvider（テーマ設定をグローバルに適用）

### UI ポイント

- マイページと統一されたデザイン（カード型レイアウト、グラデーション背景）
- 各セクションは独立したカードとして表示
- 設定変更は保存ボタンで一括保存
- テーマとフォントサイズは保存前に即座にプレビュー反映
- 保存成功時はトーストメッセージを表示（3 秒後に自動消去）
- エラー時はエラーメッセージを表示

### 実装詳細

#### 設定の永続化

- 設定値は `profiles` テーブルに保存
- ページロード時に `ThemeProvider` が設定を読み込んで適用
- 設定変更後は `revalidatePath` で関連ページを再検証

#### テーマの適用

- ダークモード: `document.documentElement.classList.add("dark")` で適用
- フォントサイズ: `document.documentElement.classList.add("font-size-{size}")` で適用
- `globals.css` にフォントサイズクラスを定義

#### 音声設定の反映

- チャット画面の `AudioButton` コンポーネントが設定を読み込む
- TTS 無効時は音声ボタンを非表示
- 速度設定（ゆっくり、ふつう、はやい）は音声再生時に反映
- 声の種類（デフォルト、女性 1、男性 1）は Web Speech API の利用可能な声から自動選択
- 設定変更は即座にチャット画面に反映される（カスタムイベント `settingsChanged` で通知）

---

## 9. レベルテスト画面

### 概要

- 初回や希望者向けに英語レベル診断テストを実施する画面

### 主な表示要素

- 診断問題の出題エリア
- 問題選択肢、回答ボタン
- 結果表示、推奨学習レベルの案内

### 主なコンポーネント

- LevelTestQuestion
- LevelTestResult

### UI ポイント

- シンプルなウィザード形式
- 結果の分かりやすい説明

---

## 10. パーソナライズ学習画面

### 概要

- ユーザーの興味や苦手分野を自己申告・選択することで、学習内容のパーソナライズを行う画面

### 主な表示要素

- 興味分野選択、レベル設定、パーソナライズオプション

### 主なコンポーネント

- PersonalizeForm

### UI ポイント

- 直感的なタグ・トグル UI
- 設定結果は AI チャット出題や教材内容に反映（将来拡張）

---

## 11. クイズ／ゲーム画面

### 概要

- 学んだ内容をクイズやゲーム形式で復習・定着を促すインタラクティブ画面

### 主な表示要素

- クイズ出題領域
- ゲーム的スコア・タイマーなど（将来拡張）

### 主なコンポーネント

- QuizQuestion
- GameArea

### UI ポイント

- 楽しく継続できる演出やフィードバック
- 成績表示やリトライ機能

---

## 12. パスワードリセット画面

### 概要

- パスワードを忘れたユーザーがリセットを申請し、新しいパスワードを再設定できる画面。

### 主な表示要素

- 登録済みメールアドレス入力フォーム
- パスワードリセット申請ボタン
- リセットメール送信後の案内
- 新しいパスワード入力・再設定フォーム（リンク遷移後）

### 主なコンポーネント

- PasswordResetRequestForm
- ResetSuccessMessage
- NewPasswordForm

### UI ポイント

- 入力エラー・成功メッセージの分かりやすい表示
- セキュリティ考慮し、最低限の入力値検証・バリデーションを徹底
- 案内文・注意点の明示

---

## 13. 学習履歴可視化画面

### 概要

- ユーザーの学習進捗をグラフや一覧で「見える化」する可視化専用画面。

### 主な表示要素

- 期間別（週/月/年）進捗グラフ
- 達成目標や連続学習日数
- チャット履歴へのショートカット

### 主なコンポーネント

- ProgressVisualizationGraph
- AchievementCard
- ChatHistoryShortcut

### UI ポイント

- 目標達成度が直感的にわかる
- 推奨学習メッセージや継続意欲を高める演出

---

## 14. マイページ画面

### 概要

- 各ユーザー固有のプロフィールやアクティビティ集約画面。

### 主な表示要素

- プロフィール情報
- 最近の学習履歴・実績
- 達成バッジや成長ステータス
- アカウント情報編集

### 主なコンポーネント

- UserProfileView
- AchievementsList
- EditProfileButton

### UI ポイント

- 個人成績・達成が一目でわかるデザイン
- シンプルで使いやすい編集動線

---

## 15. 管理者用画面

### 概要

- サービス運営者／管理者がシステム状況・ユーザー管理等を行う専用画面（管理者のみアクセス可能）

### 主な表示要素

- ユーザー一覧・検索・状態表示
- サイト全体の学習履歴統計
- お知らせ・システムメッセージ発信

### 主なコンポーネント

- UserTable
- SystemStatsView
- AnnouncementEditor

### UI ポイント

- 操作ミスや誤削除防止のための確認フロー
- 表示情報のフィルタ・CSV 出力等

---

## 16. 学習履歴可視化画面

### 概要

- ユーザーの学習活動を記録・分析し、視覚的に表示する画面
- 学習の進捗状況や活動傾向を把握し、モチベーション向上に寄与
- 記録設定で有効にしている場合のみログを記録
- 記録を無効にしても、過去のデータは閲覧可能

### 主な表示要素

0. **警告バナー（記録無効時のみ表示）**

   - 記録設定が無効の場合に黄色の警告バナーを表示
   - 内容：「現在、学習活動の記録は無効です」
   - 説明：「新しいデータは記録されませんが、過去のデータは閲覧できます。設定ページから記録を有効にできます。」
   - 設定ページへのリンクを含む

1. **サマリーカード**

   - チャット送信回数の総計
   - 音声再生回数の総計
   - ブックマーク件数の総計
   - 各カードは視認性の高いアイコンと数値で表示

2. **期間選択ボタン**

   - 7 日間、30 日間、90 日間から選択可能
   - 選択された期間に応じて統計データが更新される

3. **日別推移グラフ（折れ線グラフ）**

   - 横軸: 日付（月/日形式）
   - 縦軸: 活動回数
   - 3 つの折れ線: チャット送信、音声再生、ブックマーク
   - 各活動の推移を時系列で確認可能

4. **活動内訳グラフ（棒グラフ）**
   - チャット送信、音声再生、ブックマーク追加の総計を棒グラフで表示
   - 各活動の相対的な頻度を一目で把握可能

### 主なコンポーネント

- `HistoryPage`: メインの学習履歴画面コンポーネント
- Recharts ライブラリの各種チャートコンポーネント:
  - `LineChart`: 日別推移の折れ線グラフ
  - `BarChart`: 活動内訳の棒グラフ
  - `ResponsiveContainer`: レスポンシブ対応のコンテナ

### データフロー

1. ページロード時に `getStudyStatistics` Server Action を呼び出し
2. 指定期間（デフォルト 30 日）の学習ログを集計
3. 統計データをグラフ用に整形
4. Recharts を使用してグラフを描画
5. 期間選択時に再度データを取得・更新

### データとプライバシー保護

- 記録設定で「学習活動を記録する」を無効にしている場合、新しいログは記録されない
- 個人の学習履歴表示は、記録設定に関わらず常に利用可能（自分のデータのみ）
- 記録を無効にしても、過去に記録されたデータは保持され、閲覧できる
- データベースの Row Level Security (RLS) により、他ユーザーのログにはアクセス不可
- 記録無効時は警告バナーを表示し、ユーザーに状況を明確に伝える

### UI ポイント

- グラフは視認性の高い配色（インディゴ、パープル、イエロー）を使用
- データがない場合は、学習開始を促すメッセージを表示
- ローディング状態とエラー状態を明確に表示
- ダークモード対応（背景色、テキスト色が自動で切り替わる）
- レスポンシブデザインで、モバイルでも快適に閲覧可能

---

## 17. FAQ／サポート画面

### 概要

- よくある質問、ユーザーガイドやサポート問合せ導線を集約したサポート情報画面

### 主な表示要素

- よくある質問一覧（カテゴリ分け・検索）
- 利用ガイド・使い方動画へのリンク
- サポートへの問合せフォーム

### 主なコンポーネント

- FAQAccordion
- GuideLinkList
- InquiryForm

### UI ポイント

- 質問量が多い時も使いやすい UI
- 入力・案内の分かりやすさ重視

---

## 17. 共通サイドバー

### 概要

- 各主要画面（チャット、ブックマーク一覧、マイページ、学習履歴、設定、FAQ、管理者等）へ直感的・迅速に移動できるナビゲーション用サイドバー。

### 主な表示要素

- 画面種別ごとのナビゲーションリンク
  - チャット画面
  - ブックマーク一覧
  - 学習履歴可視化
  - マイページ
  - クイズ／ゲーム
  - 設定
  - FAQ・サポート
  - 管理者用（管理者のみ）
- ロゴ・サービス名表示
- 折りたたみ（hamburger）アイコン

### 主なコンポーネント

- SidebarNavContainer
- NavigationLinkItem
- LogoSection
- CollapseButton

### UI ポイント

- 常時表示と折りたたみ式を切替可能（レスポンシブ対応）
- アクティブ画面はハイライト、アイコン付きで直感的に
- スマートフォン時は下部ナビやドロワーメニューにも切替
- シンプル&フラットで学習を妨げず、導線が迷わない構成

---

## 画面遷移イメージ

- ログイン画面 →（認証後）→ チャット画面
- チャット画面 ↔ ブックマーク一覧画面（ヘッダーやアイコンから遷移）
- チャット画面 ↔ マイページ（`/profile`）
- チャット画面 ↔ 設定画面（`/settings`）
- サイドバーから各画面へ遷移可能
- マイページ・設定画面: 未認証時は自動的にログイン画面（`/auth/login`）にリダイレクト
- 各画面は Next.js の App Router ルーティングで URL 単位に分割

---

# 補足

- UI フレームワークは Tailwind CSS 想定、アクセシビリティ配慮
- スマホファースト対応、レスポンシブ設計
- シンプル・直感的・楽しく続けられる UI を目指す

---

## 18. Favicon（サイトアイコン）

### 概要

- ブラウザのタブやブックマークに表示されるサイトのアイコン（favicon）を設定します。
- Lingo Leap のブランドアイデンティティを反映したカスタム favicon を使用します。

### 仕様

- ファイル形式: `.ico`形式（推奨サイズ: 32x32px、複数サイズを含むマルチアイコン形式）
- 配置場所: `front/app/favicon.ico`
- Next.js の App Router では、`app`ディレクトリに配置された`favicon.ico`が自動的に認識されます
- `layout.tsx`の metadata で明示的に favicon を指定することで、ブラウザに正しいアイコンを確実に表示させます

### UI ポイント

- ブランドロゴやサービス名の頭文字（例: "L"）などを使用し、視認性の高いデザイン
- 小さなサイズでも認識しやすいシンプルなデザイン
- ダークモード・ライトモードの両方で適切に表示される配色
